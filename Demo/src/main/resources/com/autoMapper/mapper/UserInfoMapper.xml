<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.autoMapper.mapper.UserInfoMapper">
	<!-- 实体映射 -->
	<resultMap id="base_result_map" type="com.autoMapper.entity.po.UserInfo">
		<!-- 用户id -->
		<id column="user_id" property="userId"/>
		<!-- 邮箱 -->
		<result column="email" property="email"/>
		<!-- 昵称 -->
		<result column="nick_name" property="nickName"/>
		<!-- 0:直接加入 1:同意后加入 -->
		<result column="join_type" property="joinType"/>
		<!-- 性别 0:女 1:男 -->
		<result column="sex" property="sex"/>
		<!-- 密码 -->
		<result column="password" property="password"/>
		<!-- 个性签名 -->
		<result column="personal_signature" property="personalSignature"/>
		<!-- 状态 -->
		<result column="status" property="status"/>
		<!-- 创建时间 -->
		<result column="create_time" property="createTime"/>
		<!-- 最后登录时间 -->
		<result column="last_login_time" property="lastLoginTime"/>
		<!-- 地区 -->
		<result column="area_name" property="areaName"/>
		<!-- 地区编号 -->
		<result column="area_code" property="areaCode"/>
		<!-- 最后离开时间 -->
		<result column="last_off_time" property="lastOffTime"/>
	</resultMap>

<!-- 通用查询结果列 -->
	<sql id="base_column_list">
		user_id,email,nick_name,join_type,sex,password,personal_signature,status,create_time,last_login_time,area_name,area_code,last_off_time
	</sql>

<!-- 基础查询条件 -->
	<sql id="base_query_condition">
		<if test="query.userId != null ">
			and user_id = #{query.userId}
		</if>
		<if test="query.email != null and query.email!=''">
			and email = #{query.email}
		</if>
		<if test="query.nickName != null and query.nickName!=''">
			and nick_name = #{query.nickName}
		</if>
		<if test="query.joinType != null ">
			and join_type = #{query.joinType}
		</if>
		<if test="query.sex != null ">
			and sex = #{query.sex}
		</if>
		<if test="query.password != null and query.password!=''">
			and password = #{query.password}
		</if>
		<if test="query.personalSignature != null and query.personalSignature!=''">
			and personal_signature = #{query.personalSignature}
		</if>
		<if test="query.status != null ">
			and status = #{query.status}
		</if>
		<if test="query.createTime != null ">
			and create_time = #{query.createTime}
		</if>
		<if test="query.lastLoginTime != null ">
			and last_login_time = #{query.lastLoginTime}
		</if>
		<if test="query.areaName != null and query.areaName!=''">
			and area_name = #{query.areaName}
		</if>
		<if test="query.areaCode != null and query.areaCode!=''">
			and area_code = #{query.areaCode}
		</if>
		<if test="query.lastOffTime != null ">
			and last_off_time = #{query.lastOffTime}
		</if>
	</sql>

	<!-- 扩展查询条件 -->
	<sql id="base_query_condition_extend">
		<if test="query.emailFuzzy != null and query.emailFuzzy !=''">
			and email like concat('%',#{query.emailFuzzy},'%')
		</if>
		<if test="query.nickNameFuzzy != null and query.nickNameFuzzy !=''">
			and nick_name like concat('%',#{query.nickNameFuzzy},'%')
		</if>
		<if test="query.passwordFuzzy != null and query.passwordFuzzy !=''">
			and password like concat('%',#{query.passwordFuzzy},'%')
		</if>
		<if test="query.personalSignatureFuzzy != null and query.personalSignatureFuzzy !=''">
			and personal_signature like concat('%',#{query.personalSignatureFuzzy},'%')
		</if>
		<if test="query.createTimeStart != null and query.createTimeStart !=''">
			<![CDATA[ and create_time >= str_to_date(#{query.createTimeStart}, '%Y-%m-%d')]]>
		</if>
		<if test="query.createTimeEnd != null and query.createTimeEnd !=''">
			<![CDATA[ and create_time < date_sub(str_to_date(#{query.createTimeEnd}, '%Y-%m-%d'), interval -1 day)]]>
		</if>
		<if test="query.lastLoginTimeStart != null and query.lastLoginTimeStart !=''">
			<![CDATA[ and last_login_time >= str_to_date(#{query.lastLoginTimeStart}, '%Y-%m-%d')]]>
		</if>
		<if test="query.lastLoginTimeEnd != null and query.lastLoginTimeEnd !=''">
			<![CDATA[ and last_login_time < date_sub(str_to_date(#{query.lastLoginTimeEnd}, '%Y-%m-%d'), interval -1 day)]]>
		</if>
		<if test="query.areaNameFuzzy != null and query.areaNameFuzzy !=''">
			and area_name like concat('%',#{query.areaNameFuzzy},'%')
		</if>
		<if test="query.areaCodeFuzzy != null and query.areaCodeFuzzy !=''">
			and area_code like concat('%',#{query.areaCodeFuzzy},'%')
		</if>
	</sql>

	<!-- 通用查询条件 -->
	<sql id="query_condition">
		<where>
			<include refid="base_query_condition"/>
			<include refid="base_query_condition_extend"/>
		</where>
	</sql>

	<!-- 查询列表 -->
	<select id="selectList" resultMap="base_result_map">
		SELECT <include refid="base_column_list"/>
		FROM user_info 
		<include refid="query_condition"/>
		<if test="query.orderBy != null and query.orderBy != ''">
			order by ${query.orderBy}
		</if>
		<if test="query.simplePage != null">
			limit #{query.simplePage.start}, #{query.simplePage.end}
		</if>
	</select>

	<!-- 查询数量 -->
	<select id="selectCount" resultType="java.lang.Integer">
		SELECT count(1) FROM user_info 
		<include refid="query_condition"/>
	</select>
</mapper>